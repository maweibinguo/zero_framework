(function($){var win=window;var doc=document;var $win=$(win);var $doc=$(doc);$.fn.dropload=function(options){return new MyDropLoad(this,options)};var MyDropLoad=function(element,options){var me=this;me.$element=element;me.upInsertDOM=false;me.loading=false;me.isLockUp=false;me.isLockDown=false;me.isData=true;me._scrollTop=0;me._threshold=0;me.init(options)};MyDropLoad.prototype.init=function(options){var me=this;me.opts=$.extend(true,{},{scrollArea:me.$element,domUp:{domClass:"dropload-up",domRefresh:'<div class="dropload-refresh">↓下拉刷新</div>',domUpdate:'<div class="dropload-update">↑释放更新</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>'},domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中...</div>',domNoData:'<div class="dropload-noData">暂无数据</div>'},autoLoad:true,distance:50,threshold:"",loadUpFn:"",loadDownFn:""},options);if(me.opts.loadDownFn!=""){me.$element.append('<div class="'+me.opts.domDown.domClass+'">'+me.opts.domDown.domRefresh+"</div>");me.$domDown=$("."+me.opts.domDown.domClass)}if(!!me.$domDown&&me.opts.threshold===""){me._threshold=Math.floor(me.$domDown.height()*1/3)}else{me._threshold=me.opts.threshold}if(me.opts.scrollArea==win){me.$scrollArea=$win;me._scrollContentHeight=$doc.height();me._scrollWindowHeight=doc.documentElement.clientHeight}else{me.$scrollArea=me.opts.scrollArea;me._scrollContentHeight=me.$element[0].scrollHeight;me._scrollWindowHeight=me.$element.height()}fnAutoLoad(me);$win.on("resize",function(){clearTimeout(me.timer);me.timer=setTimeout(function(){if(me.opts.scrollArea==win){me._scrollWindowHeight=win.innerHeight}else{me._scrollWindowHeight=me.$element.height()}fnAutoLoad(me)},150)});me.$element.on("touchstart",function(e){if(!me.loading){fnTouches(e);fnTouchstart(e,me)}});me.$element.on("touchmove",function(e){if(!me.loading){fnTouches(e,me);fnTouchmove(e,me)}});me.$element.on("touchend",function(){if(!me.loading){fnTouchend(me)}});me.$scrollArea.on("scroll",function(){me._scrollTop=me.$scrollArea.scrollTop();if(me.opts.loadDownFn!=""&&!me.loading&&!me.isLockDown&&(me._scrollContentHeight-me._threshold)<=(me._scrollWindowHeight+me._scrollTop)){loadDown(me)}})};function fnTouches(e){if(!e.touches){e.touches=e.originalEvent.touches}}function fnTouchstart(e,me){me._startY=e.touches[0].pageY;me.touchScrollTop=me.$scrollArea.scrollTop()}function fnTouchmove(e,me){me._curY=e.touches[0].pageY;me._moveY=me._curY-me._startY;if(me._moveY>0){me.direction="down"}else{if(me._moveY<0){me.direction="up"}}var _absMoveY=Math.abs(me._moveY);if(me.opts.loadUpFn!=""&&me.touchScrollTop<=0&&me.direction=="down"&&!me.isLockUp){e.preventDefault();me.$domUp=$("."+me.opts.domUp.domClass);if(!me.upInsertDOM){me.$element.prepend('<div class="'+me.opts.domUp.domClass+'"></div>');me.upInsertDOM=true}fnTransition(me.$domUp,0);if(_absMoveY<=me.opts.distance){me._offsetY=_absMoveY;me.$domUp.html(me.opts.domUp.domRefresh)}else{if(_absMoveY>me.opts.distance&&_absMoveY<=me.opts.distance*2){me._offsetY=me.opts.distance+(_absMoveY-me.opts.distance)*0.5;me.$domUp.html(me.opts.domUp.domUpdate)}else{me._offsetY=me.opts.distance+me.opts.distance*0.5+(_absMoveY-me.opts.distance*2)*0.2}}me.$domUp.css({"height":me._offsetY})}}function fnTouchend(me){var _absMoveY=Math.abs(me._moveY);if(me.opts.loadUpFn!=""&&me.touchScrollTop<=0&&me.direction=="down"&&!me.isLockUp){fnTransition(me.$domUp,300);if(_absMoveY>me.opts.distance){me.$domUp.css({"height":me.$domUp.children().height()});me.$domUp.html(me.opts.domUp.domLoad);me.loading=true;me.opts.loadUpFn(me)}else{me.$domUp.css({"height":"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){me.upInsertDOM=false;$(this).remove()})}me._moveY=0}}function fnAutoLoad(me){if(me.opts.loadDownFn!=""&&me.opts.autoLoad){if((me._scrollContentHeight-me._threshold)<=me._scrollWindowHeight){loadDown(me)}}}function fnRecoverContentHeight(me){if(me.opts.scrollArea==win){me._scrollContentHeight=$doc.height()}else{me._scrollContentHeight=me.$element[0].scrollHeight}}function loadDown(me){me.direction="up";me.$domDown.html(me.opts.domDown.domLoad);me.loading=true;me.opts.loadDownFn(me)}MyDropLoad.prototype.lock=function(direction){var me=this;if(direction===undefined){if(me.direction=="up"){me.isLockDown=true}else{if(me.direction=="down"){me.isLockUp=true}else{me.isLockUp=true;me.isLockDown=true}}}else{if(direction=="up"){me.isLockUp=true}else{if(direction=="down"){me.isLockDown=true;me.direction="up"}}}};MyDropLoad.prototype.unlock=function(){var me=this;me.isLockUp=false;me.isLockDown=false;me.direction="up"};MyDropLoad.prototype.noData=function(flag){var me=this;if(flag===undefined||flag==true){me.isData=false}else{if(flag==false){me.isData=true}}};MyDropLoad.prototype.resetload=function(){var me=this;if(me.direction=="down"&&me.upInsertDOM){me.$domUp.css({"height":"0"}).on("webkitTransitionEnd mozTransitionEnd transitionend",function(){me.loading=false;
me.upInsertDOM=false;$(this).remove();fnRecoverContentHeight(me)})}else{if(me.direction=="up"){me.loading=false;if(me.isData){me.$domDown.html(me.opts.domDown.domRefresh);fnRecoverContentHeight(me);fnAutoLoad(me)}else{me.$domDown.html(me.opts.domDown.domNoData)}}}};function fnTransition(dom,num){dom.css({"-webkit-transition":"all "+num+"ms","transition":"all "+num+"ms"})}})(window.Zepto||window.jQuery);function parseQueryString(url){var obj={};var keyvalue=[];var key="",value="";var paraString=url.substring(url.indexOf("?")+1,url.length).split("&");for(var i in paraString){keyvalue=paraString[i].split("=");key=keyvalue[0];value=keyvalue[1];obj[key]=value}return obj}$(document).ready(function(){var page=1;var href_obj=parseQueryString(window.location.href);$(".article_content").dropload({scrollArea:window,domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多-自定义内容</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中-自定义内容...</div>',domNoData:'<div class="dropload-noData">暂无数据</div>'},loadDownFn:function(me){page++;var query_item=new Array();href_obj.now_number=page;for(var key in href_obj){var segment=key+"="+href_obj[key];query_item.push(segment)}query_str=query_item.join("&");var result="";$.ajax({type:"GET",url:"/index/ajax?"+query_str,dataType:"json",success:function(responseData){var data=responseData["data"];var arrLen=data.length;if(arrLen>0){for(var i=0;i<arrLen;i++){var tag_list_str="";for(var inner_key=0;inner_key<data[i].tag_list.length;inner_key++){tag_list_str+='<a href="/index/index/tag='+data[i].tag_list[inner_key]+'">'+data[i].tag_list[inner_key]+"</a>"}result+='<article class="excerpt excerpt-1"><a class="focus" href="/article/view?article_id="'+data[i].article_id+'" title="'+data[i].title+'"><img class="thumb" data-original="'+data[i].headimage+'" src="'+data[i].headimage+'" alt="文章头图"></a><header><a class="cat" href="/index/index?category="'+data[i].category+'" ">技术那点事<i></i></a> <h2><a href="/article/view?article_id='+data[i].article_id+'" title="'+data[i].title+'">'+data[i].title+'</a></h2></header><p class="meta"><time class="time"><i class="glyphicon glyphicon-time"></i>'+data[i].add_time+'</time><span class="views"><i class="glyphicon glyphicon-eye-open"></i> 共'+data[i].article_view_statistics+'人浏览</span><span class="glyphicon glyphicon-tag"></span>标签:'+tag_list_str+' </p> <p class="note"></p> </article>'}}else{me.lock();me.noData()}$(".article_list").append(result);me.resetload()},error:function(xhr,type){alert("Ajax error!");me.resetload()}})},threshold:50})});$(document).ready(function(){var page=1;var href_obj=parseQueryString(window.location.href);$("#postcomments").dropload({scrollArea:window,domDown:{domClass:"dropload-down",domRefresh:'<div class="dropload-refresh">↑上拉加载更多-自定义内容</div>',domLoad:'<div class="dropload-load"><span class="loading"></span>加载中-自定义内容...</div>',domNoData:'<div class="dropload-noData">暂无数据</div>'},loadDownFn:function(me){page++;var query_item=new Array();href_obj.now_number=page;for(var key in href_obj){var segment=key+"="+href_obj[key];query_item.push(segment)}query_str=query_item.join("&");var result="";$.ajax({type:"get",url:"/article/getCommentList?"+query_str,dataType:"json",success:function(responseData){var data=responseData["data"];var arrLen=data.length;if(arrLen>0){for(var i=0;i<arrLen;i++){result+='<li class="comment-content"><span class="comment-f">#'+data[i].id_num+'</span>                                            <div class="comment-avatar">                                                <img class="avatar" src="/images/icon/icon.png" alt="" draggable="false">                                            </div>                                            <div class="comment-main">                                                <p>来自用户<span class="address">zero</span>                                                    (<span class="time">'+data[i].add_time+'</span>)<br>                                                    <span class="content">'+data[i].article_comment+"</span>                                                </p>                                            </div>                                        </li>"}}else{me.lock();me.noData()}$(".commentlist").append(result);me.resetload()},error:function(xhr,type){alert("Ajax error!");me.resetload()}})},threshold:50})});
